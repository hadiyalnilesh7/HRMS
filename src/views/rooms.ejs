<%- include("./layouts/header") %>
<%- include("./layouts/sidebar") %>

<div class="dashboard-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="mb-1">üè¢ Rooms Management</h2>
        <p class="text-muted mb-0">Manage your hotel inventory and pricing.</p>
      </div>
    </div>

    <div class="row g-4">
      <!-- Add Room Form -->
      <div class="col-12 col-xl-4">
        <div class="card sticky-top" style="top: 20px; z-index: 1;">
          <div class="card-header bg-white py-3">
             <h5 class="mb-0"><i class="fa-solid fa-plus-circle me-2 text-primary"></i> Add New Room</h5>
          </div>
          <div class="card-body p-4">
            <% if (selectedRoomTypes && selectedRoomTypes.length > 0) { %>
              <form method="POST" action="/rooms/add">
                <div class="mb-3">
                  <label class="form-label">Room Number</label>
                  <input class="form-control" name="roomNo" placeholder="e.g. 101" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Room Type</label>
                  <select class="form-select" name="type" required>
                    <option value="">Select Type</option>
                    <% selectedRoomTypes.forEach(type => { %>
                      <option value="<%= type %>"><%= type %></option>
                    <% }) %>
                  </select>
                </div>
                <div class="mb-4">
                  <label class="form-label">Price Per Night (‚Çπ)</label>
                  <div class="input-group">
                    <span class="input-group-text">‚Çπ</span>
                    <input class="form-control" name="pricePerNight" placeholder="0.00" type="number" required>
                  </div>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                  <i class="fa-solid fa-plus me-2"></i> Add Room
                </button>
              </form>
            <% } else { %>
              <div class="alert alert-warning border-warning">
                <div class="d-flex gap-2">
                  <i class="fa-solid fa-triangle-exclamation mt-1"></i>
                  <div>
                    <strong>No Room Types Configured</strong>
                    <p class="mb-2 small">Go to Settings to define your room types (e.g., Deluxe, Suite) before adding rooms.</p>
                    <a href="/settings" class="btn btn-sm btn-outline-dark">Go to Settings &rarr;</a>
                  </div>
                </div>
              </div>
            <% } %>
          </div>
        </div>
      </div>

      <!-- Rooms List -->
      <div class="col-12 col-xl-8">
        <div class="card">
          <div class="card-header bg-white py-3 d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
            <h5 class="mb-0"><i class="fa-solid fa-list me-2 text-primary"></i> All Rooms</h5>
            
            <form method="GET" action="/rooms" class="d-flex gap-2 w-100 w-md-auto">
              <input type="text" name="roomNo" class="form-control form-control-sm" style="max-width: 120px;" value="<%= roomNo || '' %>" placeholder="Room No">
              <select name="roomType" class="form-select form-select-sm" style="max-width: 150px;">
                <option value="">All Types</option>
                <% if (selectedRoomTypes && selectedRoomTypes.length > 0) { %>
                  <% selectedRoomTypes.forEach(type => { %>
                    <option value="<%= type %>" <%= roomType === type ? 'selected' : '' %>><%= type %></option>
                  <% }) %>
                <% } %>
              </select>
              <button type="submit" class="btn btn-sm btn-outline-primary"><i class="fa-solid fa-search"></i></button>
              <% if (roomNo || roomType) { %>
                <a href="/rooms" class="btn btn-sm btn-outline-secondary"><i class="fa-solid fa-times"></i></a>
              <% } %>
            </form>
          </div>

          <div class="card-body p-0">
            <% if (rooms && rooms.length > 0) { %>
              <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th class="ps-4">No.</th>
                      <th>Type</th>
                      <th>Price</th>
                      <th>Status</th>
                      <th class="text-end pe-4">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% rooms.forEach(r => { %>
                      <tr>
                        <td class="ps-4 fw-bold text-primary" data-label="Room No"><%= r.roomNo %></td>
                        <td data-label="Type"><span class="badge bg-light text-dark border"><%= r.type %></span></td>
                        <td data-label="Price">‚Çπ<%= r.pricePerNight %> <small class="text-muted">/night</small></td>
                        <td data-label="Status">
                          <% if(r.status === 'available') { %>
                            <span class="badge bg-success-subtle text-success border border-success"><i class="fa-solid fa-check me-1"></i> Available</span>
                          <% } else { %>
                            <span class="badge bg-warning-subtle text-warning border border-warning"><i class="fa-solid fa-clock me-1"></i> Occupied</span>
                          <% } %>
                        </td>
                        <td class="text-end pe-4" data-label="Actions">
                          <div class="d-flex justify-content-end gap-2">
                             <form method="POST" action="/rooms/editRoom" class="d-inline">
                                <input type="hidden" name="id" value="<%= r._id %>">
                                <button type="submit" class="btn btn-sm btn-outline-primary" title="Edit">
                                  <i class="fa-solid fa-pen"></i>
                                </button>
                              </form>
                              <form method="POST" action="/rooms/delete" class="d-inline" data-confirm="Delete Room <%= r.roomNo %>? This cannot be undone.">
                                <input type="hidden" name="id" value="<%= r._id %>">
                                <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete">
                                  <i class="fa-solid fa-trash"></i>
                                </button>
                              </form>
                          </div>
                        </td>
                      </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
            <% } else { %>
              <div class="text-center py-5 text-muted">
                <i class="fa-solid fa-door-open fa-3x mb-3 opacity-25"></i>
                <p>No rooms found. Add a room to get started.</p>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>

<%- include("./layouts/footer") %>
