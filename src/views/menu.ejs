<%- include("./layouts/header") %> 
<%- include("./layouts/sidebar") %>

<div class="container-fluid">
    <div class="main-content">
      <h2>ğŸ½ï¸ Menu Management</h2>

      <% if (selectedMenuCategories && selectedMenuCategories.length > 0) { %>
        <form method="POST" action="/menu/addMenu" class="card p-3 mb-4">
          <h4>â• Add Menu Item</h4>
          <div class="form-group">
            <input class="form-control" name="name" placeholder="Item Name" required>
          </div>
          <div class="form-group">
            <input class="form-control" name="price" placeholder="Price" type="number" required>
          </div>
          <div class="form-group">
            <select class="form-control" name="category" required>
              <option value="">Select Category</option>
              <% selectedMenuCategories.forEach(category => { %>
                <option value="<%= category %>"><%= category %></option>
              <% }) %>
            </select>
          </div>
          <button type="submit" class="btn btn-primary btn-action">â• Add Item</button>
        </form>
      <% } else { %>
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
          <h5>âš ï¸ Configure Menu Categories First</h5>
          <p>You need to select menu categories in Settings before you can add new menu items.</p>
          <a href="/settings" class="btn btn-warning btn-sm">Go to Settings âš™ï¸</a>
        </div>
      <% } %>

      <h4 class="mt-4">ğŸ“‹ Menu Items</h4>
      <form method="GET" action="/menu" class="card p-3 mb-3">
        <div class="row">
          <div class="col-md-4">
            <label class="form-label">Category</label>
            <select name="category" class="form-control">
              <option value="">All Categories</option>
              <% if (selectedMenuCategories && selectedMenuCategories.length > 0) { %>
                <% selectedMenuCategories.forEach(type => { %>
                  <option value="<%= type %>" <%= (typeof category !== 'undefined' && category === type) ? 'selected' : '' %>><%= type %></option>
                <% }) %>
              <% } %>
            </select>
          </div>
        <div class="d-flex gap-2 mt-2 mb-2">
          <button type="submit" class="btn btn-primary">Search</button>
          <a href="/menu" class="btn btn-secondary">Clear</a>
        </div>
      </form>
      <% if (menu && menu.length > 0) { %>
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="table-dark">
              <tr>
                <th data-label="Item Name">Item Name</th>
                <th data-label="Category">Category</th>
                <th data-label="Price">Price</th>
                <th data-label="Actions">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% menu.forEach(i => { %>
                <tr>
                  <td data-label="Item Name"><strong><%= i.name %></strong></td>
                  <td data-label="Category"><%= i.category %></td>
                  <td data-label="Price">â‚¹<%= i.price %></td>
                  <td data-label="Actions">
                    <div class="d-flex flex-column flex-md-row gap-2">
                      <form method="POST" action="/menu/edit" class="d-inline">
                        <input type="hidden" name="id" value="<%= i._id %>">
                        <button type="submit" class="btn btn-sm btn-success w-100 w-md-auto">âœï¸ Edit</button>
                      </form>
                      <form method="POST" action="/menu/delete" class="d-inline" onsubmit="return confirm('Delete this menu item?');">
                        <input type="hidden" name="id" value="<%= i._id %>">
                        <button type="submit" class="btn btn-sm btn-danger w-100 w-md-auto">ğŸ—‘ï¸ Delete</button>
                      </form>
                    </div>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="alert alert-info">
          <p class="mb-0">ğŸ“­ No menu items yet. Add some to get started!</p>
        </div>
      <% } %>
    </div>
  </div>
</div>

<%- include("./layouts/footer") %>
